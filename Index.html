<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö Workflow ‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f6fa;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .status-bar {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .status-bar h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 20px;
        }
        
        .steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #ecf0f1;
            z-index: 1;
        }
        
        .step {
            text-align: center;
            flex: 1;
            position: relative;
            z-index: 2;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .step.completed .step-circle { 
            background: #27ae60; 
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.3);
        }
        .step.current .step-circle { 
            background: #3498db; 
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
            animation: pulse 2s infinite;
        }
        .step.pending .step-circle { 
            background: #bdc3c7; 
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(52, 152, 219, 0.1); }
            100% { box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3); }
        }
        
        .step-label {
            font-size: 14px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .controls {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 0 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover { 
            background: #2980b9; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.reset { background: #e74c3c; }
        .btn.reset:hover { 
            background: #c0392b;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }
        
        .btn.success { background: #27ae60; }
        .btn.success:hover { 
            background: #229954;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .form-container {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .form-step h2 {
            color: #2c3e50;
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .form-step p {
            color: #7f8c8d;
            margin: 0 0 25px 0;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        input:invalid {
            border-color: #e74c3c;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .shipping-calculator {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        
        .shipping-result {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
            color: #27ae60;
        }
        
        .shipping-result.paid {
            background: #fff3cd;
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .steps {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .step {
                flex-basis: calc(50% - 10px);
            }
        }
        
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.success {
            background: #d5f4e6;
            color: #27ae60;
            border-left: 4px solid #27ae60;
        }
        
        .message.error {
            background: #fadbd8;
            color: #e74c3c;
            border-left: 4px solid #e74c3c;
        }
        
        .message.info {
            background: #d6eaf8;
            color: #3498db;
            border-left: 4px solid #3498db;
        }
        
        .hidden { 
            display: none !important; 
        }
        
        .summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
        }
        
        .summary-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .summary-item h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .summary-item p {
            margin: 8px 0;
            color: #5a6c7d;
        }
        
        .current-info {
            font-weight: 600;
            color: #2c3e50;
            margin-left: 15px;
            padding: 8px 15px;
            background: #ecf0f1;
            border-radius: 20px;
            display: inline-block;
        }
        
        .data-count {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ ‡∏£‡∏∞‡∏ö‡∏ö Workflow ‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</h1>
            <p>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢ ‚Üí ‡∏ù‡πà‡∏≤‡∏¢ GR ‚Üí ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ ‚Üí ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‚Üí ‡∏™‡∏£‡∏∏‡∏õ</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
            <div class="steps">
                <div class="step current" id="step1">
                    <div class="step-circle">1</div>
                    <div class="step-label">‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢</div>
                </div>
                <div class="step pending" id="step2">
                    <div class="step-circle">2</div>
                    <div class="step-label">‡∏ù‡πà‡∏≤‡∏¢ GR</div>
                </div>
                <div class="step pending" id="step3">
                    <div class="step-circle">3</div>
                    <div class="step-label">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</div>
                </div>
                <div class="step pending" id="step4">
                    <div class="step-circle">4</div>
                    <div class="step-label">‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
                </div>
                <div class="step pending" id="step5">
                    <div class="step-circle">5</div>
                    <div class="step-label">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn" onclick="previousStep()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button class="btn" onclick="nextStep()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
            <button class="btn" onclick="addNewOrder()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
            <button class="btn reset" onclick="resetAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
            <span class="current-info" id="currentInfo">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢</span>
            <span class="data-count" id="dataCount">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: 0</span>
        </div>

        <!-- Messages -->
        <div id="successMessage" class="message success"></div>
        <div id="errorMessage" class="message error"></div>
        <div id="infoMessage" class="message info"></div>

        <!-- Form Container -->
        <div class="form-container">
            <!-- ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢ -->
            <div id="form1" class="form-step">
                <h2>üíº ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢</h2>
                <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏• *</label>
                        <input type="text" id="billNumber" placeholder="‡πÄ‡∏ä‡πà‡∏ô 001/2568" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label>
                        <input type="text" id="customerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á *</label>
                    <textarea id="deliveryAddress" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏´‡∏°‡∏π‡πà, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" required></textarea>
                </div>
                
                <div class="form-row-3">
                    <div class="form-group">
                        <label>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó) *</label>
                        <input type="number" id="orderValue" placeholder="‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ö‡∏¥‡∏•" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å *</label>
                        <select id="productType" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            <option value="‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="‡πÄ‡∏´‡∏•‡πá‡∏Å">‡πÄ‡∏´‡∏•‡πá‡∏Å (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ)</option>
                            <option value="‡∏õ‡∏π‡∏ô">‡∏õ‡∏π‡∏ô (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ)</option>
                            <option value="‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤">‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤ (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ)</option>
                            <option value="‡∏™‡∏µ">‡∏™‡∏µ</option>
                            <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                            <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏£‡∏∞‡∏õ‡∏≤">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏£‡∏∞‡∏õ‡∏≤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.) *</label>
                        <input type="number" id="estimatedDistance" placeholder="‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô" min="0" step="0.1" required>
                    </div>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ *</label>
                        <select id="vehicleType" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</option>
                            <option value="1.5‡∏ï‡∏±‡∏ô">1.5 ‡∏ï‡∏±‡∏ô (‡∏Å‡∏£‡∏∞‡∏ö‡∏∞)</option>
                            <option value="6.3‡∏ï‡∏±‡∏ô">6.3 ‡∏ï‡∏±‡∏ô (6‡∏•‡πâ‡∏≠)</option>
                            <option value="14‡∏ï‡∏±‡∏ô">14 ‡∏ï‡∏±‡∏ô (10‡∏•‡πâ‡∏≠)</option>
                            <option value="27‡∏ï‡∏±‡∏ô">27 ‡∏ï‡∏±‡∏ô (‡∏£‡∏ñ‡∏û‡πà‡∏ß‡∏á)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó) *</label>
                        <input type="number" id="quotedShippingFee" placeholder="‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                        <select id="pricingReason" onchange="updatePricingNote()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</option>
                            <option value="‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ">‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</option>
                            <option value="‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô">‡∏Ñ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</option>
                            <option value="‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©/VIP</option>
                            <option value="‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
                            <option value="‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡∏Å‡∏•‡∏á">‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>
                </div>
                
                <!-- ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
                <div class="shipping-calculator">
                    <h4>üí° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤</h4>
                    <div class="form-row">
                        <div style="flex: 1;">
                            <strong>üÜì ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ:</strong>
                            <ul style="margin: 8px 0; padding-left: 20px; font-size: 13px;">
                                <li>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚â• 3,000 ‡∏ö‡∏≤‡∏ó</li>
                                <li>‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å/‡∏õ‡∏π‡∏ô/‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤)</li>
                                <li>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‚â§ 15 ‡∏Å‡∏°.</li>
                            </ul>
                            <div style="color: #e74c3c; font-size: 12px; margin-top: 8px;">
                                <strong>üìç ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏Å‡∏°.</strong><br>
                                ‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô (‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á - 15 ‡∏Å‡∏°.)
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <strong>üöõ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£:</strong>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 8px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 13px;">
                                    <div><strong>1.5 ‡∏ï‡∏±‡∏ô (‡∏Å‡∏£‡∏∞‡∏ö‡∏∞):</strong></div><div>15 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.</div>
                                    <div><strong>6.3 ‡∏ï‡∏±‡∏ô (6‡∏•‡πâ‡∏≠):</strong></div><div>28 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.</div>
                                    <div><strong>14 ‡∏ï‡∏±‡∏ô (10‡∏•‡πâ‡∏≠):</strong></div><div>35 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.</div>
                                    <div><strong>27 ‡∏ï‡∏±‡∏ô (‡∏£‡∏ñ‡∏û‡πà‡∏ß‡∏á):</strong></div><div>40 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row" style="margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <button type="button" class="btn" onclick="calculateShippingFee()" style="background: #f39c12; flex-shrink: 0;">
                                üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                            </button>
                            <div id="shippingResult" class="shipping-result" style="display: none; margin: 0; flex: 1;">
                                ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: <span id="calculatedFee">0</span> ‡∏ö‡∏≤‡∏ó
                                <button type="button" onclick="useCalculatedFee()" style="margin-left: 10px; padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ
                                </button>
                            </div>
                        </div>
                        <div id="calculationDebug" style="font-size: 12px; color: #666; margin-top: 10px; display: none;">
                            <strong>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</strong> <span id="debugInfo"></span>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label>
                        <select id="customerType" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</option>
                            <option value="‡∏Ç‡∏≤‡∏¢‡∏õ‡∏•‡∏µ‡∏Å">‡∏Ç‡∏≤‡∏¢‡∏õ‡∏•‡∏µ‡∏Å</option>
                            <option value="‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á">‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á</option>
                            <option value="‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <input type="tel" id="customerPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label>
                        <input type="date" id="appointmentDate" required>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</label>
                        <input type="time" id="appointmentTime" placeholder="‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                    <textarea id="salesNotes" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î, ‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©"></textarea>
                    <div id="pricingNote" style="font-size: 12px; color: #7f8c8d; margin-top: 5px;"></div>
                </div>
                
                <button class="btn success" onclick="saveSales()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ù‡πà‡∏≤‡∏¢ GR</button>
            </div>

            <!-- ‡∏ù‡πà‡∏≤‡∏¢ GR -->
            <div id="form2" class="form-step hidden">
                <h2>üöõ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ù‡πà‡∏≤‡∏¢ GR (‡∏à‡∏±‡∏î‡∏™‡πà‡∏á)</h2>
                <p>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</p>
                
                <div id="currentOrderInfo" class="summary-item" style="margin-bottom: 25px;">
                    <h4>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢</h4>
                    <div id="orderDetails">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ *</label>
                        <select id="assignedDriver" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</option>
                            <option value="‡∏û‡∏µ‡πà‡∏´‡∏•‡∏ß‡∏¢">‡∏û‡∏µ‡πà‡∏´‡∏•‡∏ß‡∏¢</option>
                            <option value="‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢">‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢</option>
                            <option value="‡∏™‡∏≤‡∏¢‡∏ä‡∏•">‡∏™‡∏≤‡∏¢‡∏ä‡∏•</option>
                            <option value="‡πÅ‡∏õ‡πã‡∏á">‡πÅ‡∏õ‡πã‡∏á</option>
                            <option value="‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥">‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥</option>
                            <option value="‡∏û‡∏µ‡πà‡∏î‡∏≠‡∏ô">‡∏û‡∏µ‡πà‡∏î‡∏≠‡∏ô</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ *</label>
                        <select id="vehicleNumber" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ</option>
                            <option value="80-1684">80-1684</option>
                            <option value="81-3452">81-3452</option>
                            <option value="81-3050">81-3050</option>
                            <option value="81-3051">81-3051</option>
                            <option value="81-3052">81-3052</option>
                            <option value="81-3053+54">81-3053+54</option>
                            <option value="6767">6767</option>
                            <option value="2455">2455</option>
                            <option value="8094">8094</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üîÑ ‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</label>
                        <select id="routeGroup" onchange="updateRouteInfo()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà</option>
                            <option value="new">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ *</label>
                        <select id="approvalStatus" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</option>
                            <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç)</option>
                            <option value="‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</option>
                        </select>
                    </div>
                </div>
                
                <div id="routeGroupInfo" class="summary-item" style="display: none;">
                    <h4>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</h4>
                    <div id="routeGroupDetails"></div>
                    <button type="button" class="btn" onclick="addToRouteGroup()" style="margin-top: 10px;">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∏‡πä‡∏õ
                    </button>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡∏ù‡πà‡∏≤‡∏¢ GR</label>
                    <textarea id="grNotes" rows="2" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©, ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡∏ù‡πà‡∏≤‡∏¢ GR</label>
                    <textarea id="grNotes" rows="2" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©, ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï"></textarea>
                </div>
                
                <button class="btn success" onclick="saveGR()">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</button>
            </div>

            <!-- ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ -->
            <div id="form3" class="form-step hidden">
                <h2>üì± ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</h2>
                <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</p>
                
                <div id="driverOrderInfo" class="summary-item" style="margin-bottom: 25px;">
                    <h4>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</h4>
                    <div id="driverOrderDetails">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á (‡∏à‡∏£‡∏¥‡∏á) *</label>
                        <input type="date" id="actualDeliveryDate" required>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á *</label>
                        <input type="time" id="departureTime" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å *</label>
                        <input type="number" id="kmStart" placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö</label>
                        <input type="number" id="kmEnd" placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö" min="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ (‡∏Å‡∏°.) *</label>
                        <input type="number" step="0.1" id="actualDistance" placeholder="‡∏à‡∏≤‡∏Å GPS/Google Maps" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô</label>
                        <input type="time" id="returnTime">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</label>
                        <input type="text" id="driverAssistant" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö">
                    </div>
                    <div class="form-group">
                        <label>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
                        <select id="productChecker" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ</option>
                            <option value="‡∏û‡∏µ‡πà‡∏ô‡∏á">‡∏û‡∏µ‡πà‡∏ô‡∏á</option>
                            <option value="‡∏û‡∏µ‡πà‡∏ß‡∏¥">‡∏û‡∏µ‡πà‡∏ß‡∏¥</option>
                            <option value="‡∏û‡∏µ‡πà‡∏£‡∏∏‡πà‡∏á">‡∏û‡∏µ‡πà‡∏£‡∏∏‡πà‡∏á</option>
                            <option value="‡∏û‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏ß">‡∏û‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏ß</option>
                            <option value="‡πÄ‡∏ô‡∏™">‡πÄ‡∏ô‡∏™</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</label>
                    <textarea id="driverNotes" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏≤‡∏à‡∏£, ‡∏™‡∏†‡∏≤‡∏û‡∏ñ‡∏ô‡∏ô, ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö"></textarea>
                </div>
                
                <button class="btn success" onclick="saveDriver()">üöö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
            </div>

            <!-- ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ -->
            <div id="form4" class="form-step hidden">
                <h2>üí∞ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>
                <p>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</p>
                
                <div id="accountingOrderInfo" class="summary-item" style="margin-bottom: 25px;">
                    <h4>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h4>
                    <div id="accountingOrderDetails">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üéØ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á (‡∏Å‡∏°.) *</label>
                        <input type="number" id="confirmedDistance" placeholder="‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ" min="0" step="0.1" required onchange="recalculateShipping()">
                    </div>
                    <div class="form-group">
                        <label>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="finalShippingFee" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏¥‡∏• *</label>
                        <select id="billVerification" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                            <option value="‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option>
                            <option value="‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" step="0.01" id="fuelCost" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á" min="0" onchange="calculateProfit()">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" step="0.01" id="shippingRevenue" placeholder="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ" min="0" readonly>
                    </div>
                    <div class="form-group">
                        <label>‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" step="0.01" id="profitLoss" placeholder="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                    <textarea id="accountingNotes" rows="3" placeholder="‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï, ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞, ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ *</label>
                    <select id="finalStatus" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        <option value="‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
                    </select>
                </div>
                
                <button class="btn success" onclick="saveAccounting()">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
            </div>

            <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
            <div id="form5" class="form-step hidden">
                <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</h2>
                <p>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</p>
                
                <div id="summaryContent" class="summary">
                    <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö
        let currentStep = 1;
        let allData = [];
        let currentOrderData = {};
        let routeGroups = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            updateDataCount();
            loadTodayDate();
            updateRouteGroupOptions();
            console.log('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        function loadTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            
            const appointmentDateEl = document.getElementById('appointmentDate');
            if (appointmentDateEl) {
                appointmentDateEl.value = today;
            }
            
            const actualDeliveryDateEl = document.getElementById('actualDeliveryDate');
            if (actualDeliveryDateEl) {
                actualDeliveryDateEl.value = today;
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£
        function calculateShippingFee() {
            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á...');
            
            const orderValue = parseFloat(document.getElementById('orderValue').value) || 0;
            const productType = document.getElementById('productType').value;
            const estimatedDistance = parseFloat(document.getElementById('estimatedDistance').value) || 0;
            const vehicleType = document.getElementById('vehicleType').value;
            
            console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:', { orderValue, productType, estimatedDistance, vehicleType });
            
            const resultDiv = document.getElementById('shippingResult');
            const feeSpan = document.getElementById('calculatedFee');
            const debugDiv = document.getElementById('calculationDebug');
            const debugInfo = document.getElementById('debugInfo');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
            const missingFields = [];
            if (!orderValue) missingFields.push('‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
            if (!productType) missingFields.push('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
            if (!estimatedDistance) missingFields.push('‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á');
            if (!vehicleType) missingFields.push('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ');
            
            if (missingFields.length > 0) {
                showMessage('error', `‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö: ${missingFields.join(', ')}`);
                resultDiv.style.display = 'none';
                debugDiv.style.display = 'none';
                return;
            }
            
            let suggestedFee = 0;
            let isFree = false;
            let calculation = '';
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ
            const isGeneralProduct = !['‡πÄ‡∏´‡∏•‡πá‡∏Å', '‡∏õ‡∏π‡∏ô', '‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤'].includes(productType);
            const isHighValue = orderValue >= 3000;
            const isShortDistance = estimatedDistance <= 15;
            
            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£ (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏)
            const rateTable = {
                '1.5‡∏ï‡∏±‡∏ô': 15,   // 15 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '6.3‡∏ï‡∏±‡∏ô': 28,   // 28 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '14‡∏ï‡∏±‡∏ô': 35,    // 35 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '27‡∏ï‡∏±‡∏ô': 40     // 40 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
            };
            
            const ratePerKm = rateTable[vehicleType] || 15;
            
            if (isGeneralProduct && isHighValue && isShortDistance) {
                // ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ - ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                suggestedFee = 0;
                isFree = true;
                calculation = `‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ: ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ + ‚â•3,000‡∏ö‡∏≤‡∏ó + ‚â§15‡∏Å‡∏°.`;
            } else if (isGeneralProduct && isHighValue && !isShortDistance) {
                // ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏Å‡∏°. ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô
                const extraDistance = estimatedDistance - 15;
                suggestedFee = Math.ceil(extraDistance) * ratePerKm;
                calculation = `‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15‡∏Å‡∏°. ‚Üí ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô ${extraDistance}‡∏Å‡∏°. √ó ${ratePerKm}‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°. = ${suggestedFee}‡∏ö‡∏≤‡∏ó`;
            } else {
                // ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
                suggestedFee = Math.ceil(estimatedDistance) * ratePerKm;
                const reasons = [];
                if (!isGeneralProduct) reasons.push('‡πÄ‡∏´‡∏•‡πá‡∏Å/‡∏õ‡∏π‡∏ô/‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤');
                if (!isHighValue) reasons.push('‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ < 3,000‡∏ö‡∏≤‡∏ó');
                calculation = `‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ (${reasons.join(', ')}) ‚Üí ${estimatedDistance}‡∏Å‡∏°. √ó ${ratePerKm}‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°. = ${suggestedFee}‡∏ö‡∏≤‡∏ó`;
            }
            
            console.log('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:', { suggestedFee, calculation });
            
            feeSpan.textContent = suggestedFee.toLocaleString();
            debugInfo.textContent = calculation;
            
            resultDiv.className = isFree ? 'shipping-result' : 'shipping-result paid';
            resultDiv.style.display = 'block';
            debugDiv.style.display = 'block';
            
            showMessage('success', `‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ${suggestedFee.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
        }

        // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        function useCalculatedFee() {
            const suggestedFee = document.getElementById('calculatedFee').textContent;
            document.getElementById('quotedShippingFee').value = suggestedFee.replace(/,/g, '');
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            const fee = parseFloat(suggestedFee.replace(/,/g, ''));
            const pricingReasonEl = document.getElementById('pricingReason');
            
            if (fee === 0) {
                pricingReasonEl.value = '‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ';
            } else {
                pricingReasonEl.value = '‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô';
            }
            
            updatePricingNote();
            showMessage('success', '‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤
        function updatePricingNote() {
            const reason = document.getElementById('pricingReason').value;
            const noteEl = document.getElementById('pricingNote');
            
            if (noteEl) {
                switch(reason) {
                    case '‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ':
                        noteEl.textContent = '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ: ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ ‚â•3,000 ‡∏ö‡∏≤‡∏ó + ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ + ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‚â§15 ‡∏Å‡∏°.';
                        break;
                    case '‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô':
                        noteEl.textContent = '‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ';
                        break;
                    case '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©':
                        noteEl.textContent = '‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ VIP ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥';
                        break;
                    case '‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô':
                        noteEl.textContent = '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏û‡∏¥‡πÄ‡∏®‡∏©';
                        break;
                    case '‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡∏Å‡∏•‡∏á':
                        noteEl.textContent = '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
                        break;
                    default:
                        noteEl.textContent = '';
                }
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ)
        function recalculateShipping() {
            if (!currentOrderData.sales) return;
            
            const confirmedDistance = parseFloat(document.getElementById('confirmedDistance').value) || 0;
            const orderValue = currentOrderData.sales.orderValue;
            const productType = currentOrderData.sales.productType;
            const vehicleType = currentOrderData.sales.vehicleType;
            
            let shippingFee = 0;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á
            const isGeneralProduct = !['‡πÄ‡∏´‡∏•‡πá‡∏Å', '‡∏õ‡∏π‡∏ô', '‡∏≠‡∏¥‡∏ê‡∏°‡∏ß‡∏•‡πÄ‡∏ö‡∏≤'].includes(productType);
            const isHighValue = orderValue >= 3000;
            const isShortDistance = confirmedDistance <= 15;
            
            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£
            const rateTable = {
                '1.5‡∏ï‡∏±‡∏ô': 15,   // 15 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '6.3‡∏ï‡∏±‡∏ô': 28,   // 28 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '14‡∏ï‡∏±‡∏ô': 35,    // 35 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
                '27‡∏ï‡∏±‡∏ô': 40     // 40 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏°.
            };
            
            const ratePerKm = rateTable[vehicleType] || 15;
            
            if (isGeneralProduct && isHighValue && isShortDistance) {
                // ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ
                shippingFee = 0;
            } else if (isGeneralProduct && isHighValue && !isShortDistance) {
                // ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏Å‡∏°. ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô
                const extraDistance = confirmedDistance - 15;
                shippingFee = Math.ceil(extraDistance) * ratePerKm;
            } else {
                // ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
                shippingFee = Math.ceil(confirmedDistance) * ratePerKm;
            }
            
            document.getElementById('finalShippingFee').value = shippingFee;
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
        function calculateProfit() {
            const fuelCost = parseFloat(document.getElementById('fuelCost').value) || 0;
            const shippingRevenue = parseFloat(document.getElementById('shippingRevenue').value) || 0;
            
            const profit = shippingRevenue - fuelCost;
            document.getElementById('profitLoss').value = profit.toFixed(2);
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Workflow
        function updateStatus() {
            const stepNames = ['', '‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢', '‡∏ù‡πà‡∏≤‡∏¢ GR', '‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ', '‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', '‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'];
            
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById('step' + i);
                if (step) {
                    if (i < currentStep) {
                        step.className = 'step completed';
                    } else if (i === currentStep) {
                        step.className = 'step current';
                    } else {
                        step.className = 'step pending';
                    }
                }
            }

            const currentInfoEl = document.getElementById('currentInfo');
            if (currentInfoEl) {
                currentInfoEl.textContent = '‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ' + stepNames[currentStep];
            }

            // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô form
            for (let i = 1; i <= 5; i++) {
                const form = document.getElementById('form' + i);
                if (form) {
                    if (i === currentStep) {
                        form.classList.remove('hidden');
                    } else {
                        form.classList.add('hidden');
                    }
                }
            }
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function updateDataCount() {
            const dataCountEl = document.getElementById('dataCount');
            if (dataCountEl) {
                dataCountEl.textContent = `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${allData.length}`;
            }
        }

        // ‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        function nextStep() {
            if (currentStep < 5) {
                currentStep++;
                updateStatus();
                hideMessages();
            }
        }

        // ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStatus();
                hideMessages();
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
        function addNewOrder() {
            currentStep = 1;
            currentOrderData = {};
            clearAllForms();
            updateStatus();
            hideMessages();
            showMessage('info', 'üÜï ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà');
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
        function resetAll() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                currentStep = 1;
                allData = [];
                currentOrderData = {};
                updateStatus();
                updateDataCount();
                clearAllForms();
                hideMessages();
                showMessage('success', 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            }
        }

                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• form ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function clearAllForms() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'date') {
                    if (input.id === 'appointmentDate' || input.id === 'actualDeliveryDate') {
                        input.value = new Date().toISOString().split('T')[0];
                    }
                } else {
                    input.value = '';
                }
            });
            
            const shippingResult = document.getElementById('shippingResult');
            if (shippingResult) shippingResult.style.display = 'none';
            
            const calculationDebug = document.getElementById('calculationDebug');
            if (calculationDebug) calculationDebug.style.display = 'none';
            
            const routeGroupInfo = document.getElementById('routeGroupInfo');
            if (routeGroupInfo) routeGroupInfo.style.display = 'none';
            
            updateRouteGroupOptions();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        function showMessage(type, text) {
            hideMessages();
            const messageEl = document.getElementById(type + 'Message');
            if (messageEl) {
                messageEl.textContent = text;
                messageEl.style.display = 'block';
                setTimeout(hideMessages, 4000);
            }
        }

        function hideMessages() {
            const messages = ['successMessage', 'errorMessage', 'infoMessage'];
            messages.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function validateForm(formType) {
            const requiredFields = {
                sales: ['billNumber', 'customerName', 'deliveryAddress', 'orderValue', 'productType', 'estimatedDistance', 'vehicleType', 'quotedShippingFee', 'customerType', 'appointmentDate'],
                gr: ['assignedDriver', 'approvalStatus', 'vehicleNumber'],
                driver: ['actualDeliveryDate', 'departureTime', 'kmStart', 'actualDistance', 'productChecker'],
                accounting: ['confirmedDistance', 'billVerification', 'finalStatus']
            };

            const fields = requiredFields[formType];
            if (!fields) return true;

            const missingFields = [];

            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && (!field.value || !field.value.trim())) {
                    const label = field.closest('.form-group').querySelector('label');
                    const fieldName = label ? label.textContent.replace(' *', '') : fieldId;
                    missingFields.push(fieldName);
                }
            });

            if (missingFields.length > 0) {
                showMessage('error', `‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô: ${missingFields.join(', ')}`);
                return false;
            }

            return true;
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢
        function saveSales() {
            if (!validateForm('sales')) return;

            currentOrderData = {
                sales: {
                    billNumber: document.getElementById('billNumber').value.trim(),
                    customerName: document.getElementById('customerName').value.trim(),
                    deliveryAddress: document.getElementById('deliveryAddress').value.trim(),
                    orderValue: parseFloat(document.getElementById('orderValue').value),
                    productType: document.getElementById('productType').value,
                    estimatedDistance: parseFloat(document.getElementById('estimatedDistance').value),
                    vehicleType: document.getElementById('vehicleType').value,
                    quotedShippingFee: parseFloat(document.getElementById('quotedShippingFee').value),
                    pricingReason: document.getElementById('pricingReason').value,
                    customerType: document.getElementById('customerType').value,
                    customerPhone: document.getElementById('customerPhone').value.trim(),
                    appointmentDate: document.getElementById('appointmentDate').value,
                    appointmentTime: document.getElementById('appointmentTime').value,
                    salesNotes: document.getElementById('salesNotes').value.trim(),
                    timestamp: new Date().toISOString()
                }
            };

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•‡∏ã‡πâ‡∏≥
            const existingBill = allData.find(data => 
                data.sales && data.sales.billNumber === currentOrderData.sales.billNumber
            );
            
            if (existingBill) {
                showMessage('error', '‚ùå ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            showMessage('success', '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ù‡πà‡∏≤‡∏¢ GR...');
            
            setTimeout(() => {
                updateOrderInfo();
                nextStep();
            }, 1500);
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡πà‡∏≤‡∏¢ GR
        function saveGR() {
            if (!validateForm('gr')) return;

            currentOrderData.gr = {
                assignedDriver: document.getElementById('assignedDriver').value,
                vehicleNumber: document.getElementById('vehicleNumber').value,
                approvalStatus: document.getElementById('approvalStatus').value,
                grNotes: document.getElementById('grNotes').value.trim(),
                timestamp: new Date().toISOString()
            };

            showMessage('success', '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ...');
            
            setTimeout(() => {
                updateOrderInfo();
                nextStep();
            }, 1500);
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ
        function saveDriver() {
            if (!validateForm('driver')) return;

            currentOrderData.driver = {
                actualDeliveryDate: document.getElementById('actualDeliveryDate').value,
                departureTime: document.getElementById('departureTime').value,
                kmStart: parseFloat(document.getElementById('kmStart').value),
                kmEnd: parseFloat(document.getElementById('kmEnd').value) || null,
                actualDistance: parseFloat(document.getElementById('actualDistance').value),
                returnTime: document.getElementById('returnTime').value,
                driverAssistant: document.getElementById('driverAssistant').value.trim(),
                productChecker: document.getElementById('productChecker').value,
                driverNotes: document.getElementById('driverNotes').value.trim(),
                timestamp: new Date().toISOString()
            };

            showMessage('success', '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ...');
            
            setTimeout(() => {
                updateOrderInfo();
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ - ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö
                if (currentOrderData.driver && currentOrderData.driver.actualDistance) {
                    document.getElementById('confirmedDistance').value = currentOrderData.driver.actualDistance;
                    recalculateShipping();
                }
                document.getElementById('shippingRevenue').value = currentOrderData.sales.quotedShippingFee;
                calculateProfit();
                nextStep();
            }, 1500);
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        function saveAccounting() {
            if (!validateForm('accounting')) return;

            currentOrderData.accounting = {
                confirmedDistance: parseFloat(document.getElementById('confirmedDistance').value),
                finalShippingFee: parseFloat(document.getElementById('finalShippingFee').value) || 0,
                billVerification: document.getElementById('billVerification').value,
                fuelCost: parseFloat(document.getElementById('fuelCost').value) || 0,
                shippingRevenue: parseFloat(document.getElementById('shippingRevenue').value) || 0,
                profitLoss: parseFloat(document.getElementById('profitLoss').value) || 0,
                accountingNotes: document.getElementById('accountingNotes').value.trim(),
                finalStatus: document.getElementById('finalStatus').value,
                timestamp: new Date().toISOString()
            };

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            currentOrderData.id = Date.now();
            currentOrderData.completedAt = new Date().toISOString();
            allData.push(currentOrderData);

            showMessage('success', 'üéâ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!');
            updateDataCount();
            
            setTimeout(() => {
                updateSummary();
                nextStep();
            }, 2000);
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function updateOrderInfo() {
            if (!currentOrderData || !currentOrderData.sales) return;
            
            let orderDetails = `
                <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•:</strong> ${currentOrderData.sales.billNumber}</p>
                <p><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${currentOrderData.sales.customerName}</p>
                <p><strong>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤:</strong> ${currentOrderData.sales.orderValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${currentOrderData.sales.productType}</p>
                <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:</strong> ${currentOrderData.sales.estimatedDistance} ‡∏Å‡∏°.</p>
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ:</strong> ${currentOrderData.sales.vehicleType}</p>
                <p><strong>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠:</strong> ${currentOrderData.sales.quotedShippingFee} ‡∏ö‡∏≤‡∏ó</p>
                <p><strong>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${currentOrderData.sales.pricingReason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${currentOrderData.sales.deliveryAddress}</p>
                <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î:</strong> ${currentOrderData.sales.appointmentDate} ${currentOrderData.sales.appointmentTime || ''}</p>
            `;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï element ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
            const elements = ['orderDetails', 'driverOrderDetails', 'accountingOrderDetails'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.innerHTML = orderDetails;
                }
            });

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            if (currentOrderData.gr) {
                const grDetails = `
                    <p><strong>‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö:</strong> ${currentOrderData.gr.assignedDriver}</p>
                    <p><strong>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ:</strong> ${currentOrderData.gr.vehicleNumber}</p>
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${currentOrderData.gr.approvalStatus}</p>
                `;
                
                const driverEl = document.getElementById('driverOrderDetails');
                const accountingEl = document.getElementById('accountingOrderDetails');
                
                if (driverEl) driverEl.innerHTML += grDetails;
                if (accountingEl) accountingEl.innerHTML += grDetails;
            }

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
            if (currentOrderData.driver) {
                const driverDetails = `
                    <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á:</strong> ${currentOrderData.driver.actualDeliveryDate}</p>
                    <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á:</strong> ${currentOrderData.driver.actualDistance} ‡∏Å‡∏°.</p>
                    <p><strong>‡πÑ‡∏°‡∏•‡πå:</strong> ${currentOrderData.driver.kmStart} - ${currentOrderData.driver.kmEnd || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å'}</p>
                    <p><strong>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ:</strong> ${currentOrderData.driver.productChecker}</p>
                `;
                
                const accountingEl = document.getElementById('accountingOrderDetails');
                if (accountingEl) accountingEl.innerHTML += driverDetails;
            }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function updateSummary() {
            const summaryEl = document.getElementById('summaryContent');
            if (!summaryEl) return;

            if (allData.length === 0) {
                summaryEl.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
                return;
            }

            const recentData = allData.slice(-5).reverse();
            let summaryHTML = '<h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>';

            recentData.forEach((data, index) => {
                const isFreeDelivery = data.accounting && data.accounting.finalShippingFee === 0;
                const statusColor = isFreeDelivery ? '#27ae60' : '#f39c12';
                
                summaryHTML += `
                    <div class="summary-item" style="border-left-color: ${statusColor};">
                        <h4>üì¶ ${data.sales ? data.sales.billNumber : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•'} - ${data.sales ? data.sales.customerName : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div>
                                <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:</strong><br>
                                ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤: ${data.sales ? data.sales.orderValue.toLocaleString() : '0'} ‡∏ö‡∏≤‡∏ó<br>
                                ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${data.sales ? data.sales.productType : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                            </div>
                            <div>
                                <strong>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</strong><br>
                                ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á: ${data.accounting ? data.accounting.confirmedDistance : data.sales?.estimatedDistance || 0} ‡∏Å‡∏°.<br>
                                ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ${data.accounting ? data.accounting.finalShippingFee : '0'} ‡∏ö‡∏≤‡∏ó ${isFreeDelivery ? '(‡∏ü‡∏£‡∏µ)' : ''}
                            </div>
                            <div>
                                <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong><br>
                                ${data.accounting ? data.accounting.finalStatus : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}<br>
                                ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö: ${data.gr ? data.gr.assignedDriver : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                            </div>
                        </div>
                    </div>
                `;
            });

            summaryEl.innerHTML = summaryHTML;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        function updateRouteGroupOptions() {
            const routeGroupSelect = document.getElementById('routeGroup');
            if (!routeGroupSelect) return;

            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°
            routeGroupSelect.innerHTML = '';
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà';
            routeGroupSelect.appendChild(defaultOption);
            
            const newOption = document.createElement('option');
            newOption.value = 'new';
            newOption.textContent = '+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà';
            routeGroupSelect.appendChild(newOption);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
            if (routeGroups && routeGroups.length > 0) {
                routeGroups.forEach((group, index) => {
                    const option = document.createElement('option');
                    option.value = 'group_' + index;
                    option.textContent = '‡∏Å‡∏£‡∏∏‡πä‡∏õ ' + (index + 1) + ': ' + group.name + ' (' + group.bills.length + ' ‡∏ö‡∏¥‡∏•)';
                    routeGroupSelect.appendChild(option);
                });
            }
        }

        function updateRouteInfo() {
            const routeGroupSelect = document.getElementById('routeGroup');
            const routeGroupInfo = document.getElementById('routeGroupInfo');
            const routeGroupDetails = document.getElementById('routeGroupDetails');
            
            if (!routeGroupSelect || !routeGroupInfo || !routeGroupDetails) return;
            
            const routeGroup = routeGroupSelect.value;

            if (routeGroup && routeGroup !== 'new') {
                const groupIndex = parseInt(routeGroup.replace('group_', ''));
                const group = routeGroups[groupIndex];
                
                if (group) {
                    let detailsHTML = '<h5>‡∏Å‡∏£‡∏∏‡πä‡∏õ: ' + group.name + '</h5>';
                    detailsHTML += '<p><strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á:</strong> ' + group.route + '</p>';
                    detailsHTML += '<p><strong>‡∏ö‡∏¥‡∏•‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡πä‡∏õ:</strong></p><ul>';
                    
                    group.bills.forEach(function(bill) {
                        detailsHTML += '<li>' + bill.billNumber + ' - ' + bill.customerName + ' (' + bill.orderValue.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó)</li>';
                    });
                    
                    detailsHTML += '</ul>';
                    routeGroupDetails.innerHTML = detailsHTML;
                    routeGroupInfo.style.display = 'block';
                }
            } else if (routeGroup === 'new') {
                routeGroupDetails.innerHTML = '<p>‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ</p><p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∏‡πä‡∏õ:</strong> <input type="text" id="newGroupName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π-‡πÄ‡∏°‡∏∑‡∏≠‡∏á" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 250px;"></p>';
                routeGroupInfo.style.display = 'block';
            } else {
                routeGroupInfo.style.display = 'none';
            }
        }

        function addToRouteGroup() {
            const routeGroupSelect = document.getElementById('routeGroup');
            if (!routeGroupSelect) return;
            
            const routeGroup = routeGroupSelect.value;
            
            if (!currentOrderData.sales) {
                showMessage('error', '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            if (routeGroup === 'new') {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÉ‡∏´‡∏°‡πà
                const newGroupNameInput = document.getElementById('newGroupName');
                if (!newGroupNameInput) {
                    showMessage('error', '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∏‡πä‡∏õ');
                    return;
                }
                
                const groupName = newGroupNameInput.value.trim();
                if (!groupName) {
                    showMessage('error', '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∏‡πä‡∏õ');
                    return;
                }

                const newGroup = {
                    name: groupName,
                    route: currentOrderData.sales.deliveryAddress,
                    bills: [currentOrderData.sales],
                    createdAt: new Date().toISOString()
                };

                routeGroups.push(newGroup);
                currentOrderData.gr = currentOrderData.gr || {};
                currentOrderData.gr.routeGroupIndex = routeGroups.length - 1;
                
            } else if (routeGroup.indexOf('group_') === 0) {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                const groupIndex = parseInt(routeGroup.replace('group_', ''));
                if (routeGroups[groupIndex]) {
                    routeGroups[groupIndex].bills.push(currentOrderData.sales);
                    currentOrderData.gr = currentOrderData.gr || {};
                    currentOrderData.gr.routeGroupIndex = groupIndex;
                }
            }

            updateRouteGroupOptions();
            showMessage('success', '‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
    </script>
</body>
</html>
